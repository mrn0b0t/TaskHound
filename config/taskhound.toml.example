# TaskHound Configuration File
#
# This file allows you to define default values for TaskHound CLI arguments.
# Place this file at ~/.config/taskhound/taskhound.toml or in your current working directory.
#
# Priority: CLI Args > Env Vars > Local Config > User Config > Defaults

[authentication]
# Default credentials
# username = "svc_taskhound"
# domain = "CORP.LOCAL"
# password = "Password123!"
# hashes = "aad3b435b51404eeaad3b435b51404ee:..." (optional)
# aes_key = "0123456789abcdef..." (AES-128: 32 hex chars, AES-256: 64 hex chars)
# kerberos = true

[target]
# Default domain controller
# dc_ip = "10.0.0.1"
# nameserver = "10.0.0.53"  # DNS server for lookups (defaults to dc_ip or system DNS)
# target = "10.0.0.1"
# targets_file = "targets.txt"
# timeout = 60
# threads = 10  # Parallel workers for multi-target scans (default: 1)
# rate_limit = 5.0  # Max targets per second (default: unlimited)
# dns_tcp = false  # Force DNS over TCP (required for SOCKS proxies/proxychains)

[scanning]
# Default scan options
# offline = "./offline_data"
# include_local = true
# include_ms = false  # Include tasks in \Microsoft folder
# include_all = false  # Include ALL tasks (very slow, includes everything)
# unsaved_creds = true
# credguard_detect = false
# bh_data = "path/to/data.json"

[opsec]
# OPSEC (Operational Security) settings
# Controls which network protocols are used during scans
# enabled = false  # Enable full OPSEC mode (equivalent to --opsec CLI flag)
                   # Sets both no_ldap and no_rpc to true
# no_ldap = false  # Disable LDAP operations (SID resolution, GC queries, domain SID prefetch)
# no_rpc = false   # Disable RPC operations (LSARPC SID lookup, CredGuard detection, credential validation)
#
# Protocol Impact:
#   - SMB: Always used for task enumeration (cannot be disabled)
#   - LDAP (port 389/636): SID resolution, tier-0 detection, pwdLastSet queries
#   - Global Catalog (port 3268/3269): Cross-domain SID resolution
#   - LSARPC (SMB named pipe): Fallback SID resolution via target's LSA
#   - Remote Registry (SMB named pipe): Credential Guard detection
#   - Task Scheduler RPC (SMB named pipe): Credential validation
#
# SID Resolution Chain:
#   Default:     BloodHound → Cache → LSARPC → LDAP → GC
#   --no-ldap:   BloodHound → Cache → LSARPC
#   --no-rpc:    BloodHound → Cache → LDAP → GC
#   --opsec:     BloodHound → Cache (only)

[cache]
# Caching options for SID resolution, BloodHound queries, and LAPS credentials
# enabled = true
# ttl = 86400  # 24 hours in seconds (applies to all cached data)
# file = "~/.taskhound/cache.db"  # SQLite cache file location

[laps]
# LAPS (Local Administrator Password Solution) settings
# enabled = false  # Enable LAPS authentication mode
# user = "Administrator"  # Override local admin username (default: from msLAPS-Password JSON or 'Administrator')
# force = false  # Force LAPS usage even in OPSEC mode

[credential_validation]
# Credential Validation via Task Scheduler RPC
# Queries task execution history to determine if stored passwords are valid
# WARNING: Creates additional RPC traffic - may be detectable
# enabled = false

[bloodhound]
# BloodHound connection settings
live = false
connector = "http://127.0.0.1:8080"
# username = "admin"
# password = "password"
# api_key = "key_id"
# api_key_id = "key_secret"
timeout = 120
type = "bhce" # or "legacy"
# save_file = "bh_queries.json"

[bloodhound.opengraph]
# OpenGraph generation settings
# Files are saved to {output_dir}/opengraph/ (uses main --output-dir)
enabled = true
no_upload = false
# force_icon = false  # Force icon update even if already exists
icon = "clock"
color = "#8B5CF6"
# allow_orphans = false  # Create edges even when nodes are missing

[ldap]
# LDAP SID resolution settings
# no_ldap = false
# user = "svc_ldap"
# password = "password"
# hashes = "LM:NT"
# domain = "domain.local"
# tier0 = false  # Enable LDAP-based Tier-0 detection via group membership queries
# gc_server = "10.0.0.1"  # Global Catalog server IP for foreign domain SID resolution (auto-discovers if not set)

[dpapi]
# DPAPI credential decryption settings
# loot = false  # Enable automatic download and decryption of ALL Task Scheduler credential blobs
# key = "0x51e43225e5b43b25d3768a2ae7f99934cb35d3ea"  # DPAPI_SYSTEM userkey from LSA secrets

[output]
# Output formats and directory structure
# formats = ["plain"]  # Output formats: plain, json, csv, html (comma-separated in CLI: -o plain,json,html)
# dir = "./output"     # Base output directory (default: ./output)
# no_backup = false    # Disable raw XML backup collection (backup is ON by default)
# no_summary = false   # Disable summary output
# debug = false
# verbose = false
#
# Directory structure created:
#   ./output/
#   ├── plain/           # Plain text output (if 'plain' in formats)
#   │   ├── summary.txt
#   │   └── <host>/tasks.txt
#   ├── json/            # JSON output (if 'json' in formats)
#   │   └── taskhound_results.json
#   ├── csv/             # CSV output (if 'csv' in formats)
#   │   └── taskhound_results.csv
#   ├── html/            # HTML report (if 'html' in formats)
#   │   └── taskhound_report.html
#   └── raw_backups/     # Raw XML backups (unless --no-backup)
#       └── <host>/
#           ├── tasks/*.xml
#           └── dpapi_loot/   # DPAPI files (with --loot)
#               ├── masterkeys/
#               └── credentials/
